import os
import faiss
import langchain


from langchain import PromptTemplate
from langchain.prompts import (ChatPromptTemplate,PromptTemplate,SystemMessagePromptTemplate, HumanMessagePromptTemplate)
from langchain.chat_models import ChatOpenAI
from langchain.chains import LLMChain
from langchain.llms import OpenAI

api_key=os.environ["OPENAI_API_KEY"]

def get_response(request):
    llm = OpenAI(model_name="text-davinci-003", temperature=0)

    context="""You are a home assistant robot that can retrieve objects for your user. 
        You are looking for a single item to search for.  You should ask clarifying questions of your user, 
        only if needed, until you have a sufficient description of 
        a specific item to search for and retrieve.
        If the item seems vague, make a suggestion"""
    
    system_message_prompt=SystemMessagePromptTemplate.from_template(context)
    human_template=f"Isolate what I am requesting: {request}"
    human_message_prompt=HumanMessagePromptTemplate.from_template(human_template)
    

    chat_prompt=ChatPromptTemplate.from_messages([system_message_prompt,human_message_prompt])
    chain=LLMChain(llm=llm, prompt=chat_prompt)
    response=chain.run(question=request)
    response=response.replace("\n","")



    return response

if __name__=="__main__":
    #request="Please get me a bottle of water"
    #request="Please get me a something cold to drink"
    request="I'm thirsty"

    #request="Please bring me my comb"
    #request="please get me something to fix my hair"
    #request="My hair is messy"

    #request="Please bring me the TV remote"
    #request="I'd like to turn on the TV"
    #request="Id like to watch something"

    print(get_response(request))
